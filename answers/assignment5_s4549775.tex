\documentclass[12pt, a4paper]{article}

\usepackage{enumerate}
\usepackage{listings}

\lstset{
	breaklines=true
}

\setlength\parskip{1em}
\setlength\parindent{0em}

\title{Assignment 5}

\author{Hendrik Werner s4549775}

\begin{document}
\maketitle

\section{} %1
\begin{enumerate}[a]
	\item %a
	The first thing we want to do is set a policy that applies to all traffic that does not math any of the rules. The firewall is supposed to be as restrictive as possible so we drop all packages not matching any rule.

	\begin{lstlisting}[language=bash]
# "--table filter" is the default
iptables --policy INPUT DROP
iptables --policy OUTPUT DROP
iptables --policy FORWARD DROP
	\end{lstlisting}

	Now we can selectively enable all traffic we want to accept.

	\begin{lstlisting}
# <interface> could be eth0, for example

# allow incoming HTTP
iptables -i <interface> --append INPUT --protocol tcp --destination 200.123.123.2 --dport 80 --jump ACCEPT
# allow outgoing HTTP
iptables -o <interface> --append OUTPUT --protocol tcp --source 200.123.123.2 --sport 80 --jump ACCEPT

# allow secured incoming SMTP traffic
iptables -i <interface> --append INPUT --protocol tcp --source 1.2.3.4 --sport 465 --jump ACCEPT
# allow secured outgoing SMTP traffic
iptables -o <interface> --append OUTPUT --protocol tcp --destination 1.2.3.4 --dport 465 --jump ACCEPT

# allow secured incoming IMAP
iptables -i <interface> --append INPUT --protocol tcp --source 1.2.3.4 --sport 993 --jump ACCEPT
# allow secured outgoing IMAP
iptables -o <interface> --append OUTPUT --protocol tcp --destination 1.2.3.4 --dport 993 --jump ACCEPT

# allow incoming ICMP replies
iptables -i <interface> --append INPUT --protocol icmp --icmp-type 0 --jump ACCEPT
# allow outgoing ICMP requests
iptables -o <interface> --append OUTPUT --protocol icmp --icmp-type 8 --jump ACCEPT
	\end{lstlisting}
	\item %b
	\item %c
	Using state we can disallow incoming HTTP traffic that does not belong to a conversation that was initiated from within the network. This way we can only receive HTTP from a server we contacted first.

	\begin{lstlisting}
# allow incoming HTTP
iptables -i <interface> --append INPUT --protocol tcp --destination 200.123.123.2 --dport 80 --jump ACCEPT --state ESTABLISHED
	\end{lstlisting}
\end{enumerate}

\section{} %2

\section{} %3
\begin{enumerate}[a]
	\item %a
	\item %b
	\item %c
	\item %d
\end{enumerate}

\section{} %4
\begin{enumerate}[a]
	\item %a
	The client initiated the TLS protocol with the "Client Hello" in packet 4. Packet 14 is sent from that same address so it is sent by the client.
	\item %b
	You can see the server's IP and port in the "Dst" and "Dst Port" fields. IP: 87.248.116.12, Port: 443.
	\item %c
	Normally the server would respond with a sequence number that is the previous ACK plus 1. The previous ACK is 5247 so the next sequence number would be 5248. However the next packet is also sent by the client and it does not make sense to acknowledge your own packets.

	We asked Jon about this but he couldn't help us.
	\item %d
	Packet 14 contains 3 SSL records. One is a "Client Key Exchange" record, another one is a "Change Cipher Spec" record a, and the last one is a "Multiple Handshake Records" record.
	\item %e
	\item %f
	\item %g
\end{enumerate}

\section{} %5
\begin{enumerate}[a]
	\item %a
	\item %b
\end{enumerate}

\end{document}
